SELECT hash_group(0::int, 0::int, 0::int, 0::int);
 hash_group 
------------
 1045380339
(1 row)

SELECT hash_group('0'::text, '2015-02-01'::timestamp, 1.2);
 hash_group 
------------
  728091152
(1 row)

SELECT hash_group(null::text);
 hash_group 
------------
          0
(1 row)

SELECT hash_group(null::text, null::text);
 hash_group 
------------
          0
(1 row)

SELECT hash_group(1::int8, 2::int4);
 hash_group 
------------
 1299455662
(1 row)

SELECT hash_group(1::int4, 2::int8);
 hash_group 
------------
 1299455662
(1 row)

SELECT hash_group(0::int2, null::int2);
 hash_group 
------------
  468481233
(1 row)

SELECT hash_group(null::int2, null::int2);
 hash_group 
------------
          0
(1 row)

SELECT date_trunc('second', '2015-01-01'::timestamp) + i * interval '1 second' AS ts, ls_hash_group(date_trunc('second', '2015-01-01'::timestamp) + i * interval '1 second', 0::int4) AS key
FROM generate_series(1, 100) AS i ORDER BY key;
            ts            |         key          
--------------------------+----------------------
 Thu Jan 01 00:00:01 2015 | -6010367887024207961
 Thu Jan 01 00:00:02 2015 | -6006072919529716873
 Thu Jan 01 00:00:03 2015 | -6001777953274864764
 Thu Jan 01 00:00:04 2015 | -5997482985901978564
 Thu Jan 01 00:00:05 2015 | -5993188017466322575
 Thu Jan 01 00:00:06 2015 | -5988893049756750509
 Thu Jan 01 00:00:07 2015 | -5984598082928005951
 Thu Jan 01 00:00:08 2015 | -5980303115226463433
 Thu Jan 01 00:00:09 2015 | -5976008147769555143
 Thu Jan 01 00:00:10 2015 | -5971713182119743254
 Thu Jan 01 00:00:11 2015 | -5967418214576230390
 Thu Jan 01 00:00:12 2015 | -5963123246035482027
 Thu Jan 01 00:00:13 2015 | -5958828279834838340
 Thu Jan 01 00:00:14 2015 | -5954533312920353055
 Thu Jan 01 00:00:15 2015 | -5950238345069332950
 Thu Jan 01 00:00:16 2015 | -5945943377469368805
 Thu Jan 01 00:00:17 2015 | -5941648411263636197
 Thu Jan 01 00:00:18 2015 | -5937353442116842136
 Thu Jan 01 00:00:19 2015 | -5933058475204522896
 Thu Jan 01 00:00:20 2015 | -5928763507433575362
 Thu Jan 01 00:00:21 2015 | -5924468540111268989
 Thu Jan 01 00:00:22 2015 | -5920173574126268897
 Thu Jan 01 00:00:23 2015 | -5915878605990012423
 Thu Jan 01 00:00:24 2015 | -5911583638990692398
 Thu Jan 01 00:00:25 2015 | -5907288672287055272
 Thu Jan 01 00:00:26 2015 | -5902993704137931005
 Thu Jan 01 00:00:27 2015 | -5898698738132545497
 Thu Jan 01 00:00:28 2015 | -5894403771071851781
 Thu Jan 01 00:00:29 2015 | -5890108801939855300
 Thu Jan 01 00:00:30 2015 | -5885813834918282047
 Thu Jan 01 00:00:31 2015 | -5881518868254591950
 Thu Jan 01 00:00:32 2015 | -5877223901638094833
 Thu Jan 01 00:00:33 2015 | -5872928933250048142
 Thu Jan 01 00:00:34 2015 | -5868633966527191260
 Thu Jan 01 00:00:35 2015 | -5864338999749367855
 Thu Jan 01 00:00:36 2015 | -5860044032721529478
 Thu Jan 01 00:00:37 2015 | -5855749064270496797
 Thu Jan 01 00:00:38 2015 | -5851454097807040496
 Thu Jan 01 00:00:39 2015 | -5847159130785036208
 Thu Jan 01 00:00:40 2015 | -5842864163293434076
 Thu Jan 01 00:00:41 2015 | -5838569195969967878
 Thu Jan 01 00:00:42 2015 | -5834274228784242555
 Thu Jan 01 00:00:43 2015 | -5829979261279907304
 Thu Jan 01 00:00:44 2015 | -5825684292336699286
 Thu Jan 01 00:00:45 2015 | -5821389326721713504
 Thu Jan 01 00:00:46 2015 | -5817094358995699546
 Thu Jan 01 00:00:47 2015 | -5812799392161644943
 Thu Jan 01 00:00:48 2015 | -5808504425217421076
 Thu Jan 01 00:00:49 2015 | -5804209456812043761
 Thu Jan 01 00:00:50 2015 | -5799914489996322945
 Thu Jan 01 00:00:51 2015 | -5795619521947602689
 Thu Jan 01 00:00:52 2015 | -5791324555188431576
 Thu Jan 01 00:00:53 2015 | -5787029587894509290
 Thu Jan 01 00:00:54 2015 | -5782734620958524313
 Thu Jan 01 00:00:55 2015 | -5778439652428473713
 Thu Jan 01 00:00:56 2015 | -5774144686719855843
 Thu Jan 01 00:00:57 2015 | -5769849719103071860
 Thu Jan 01 00:00:58 2015 | -5765554751678407021
 Thu Jan 01 00:00:59 2015 | -5761259783077132259
 Thu Jan 01 00:01:00 2015 | -5756964816114218744
 Thu Jan 01 00:01:01 2015 | -5752669848869021082
 Thu Jan 01 00:01:02 2015 | -5748374881985608844
 Thu Jan 01 00:01:03 2015 | -5744079915600022119
 Thu Jan 01 00:01:04 2015 | -5739784947629542636
 Thu Jan 01 00:01:05 2015 | -5735489979142294712
 Thu Jan 01 00:01:06 2015 | -5731195012746435562
 Thu Jan 01 00:01:07 2015 | -5726900044985129400
 Thu Jan 01 00:01:08 2015 | -5722605078891513141
 Thu Jan 01 00:01:09 2015 | -5718310110821544004
 Thu Jan 01 00:01:10 2015 | -5714015144408937180
 Thu Jan 01 00:01:11 2015 | -5709720176678455207
 Thu Jan 01 00:01:12 2015 | -5705425209896424536
 Thu Jan 01 00:01:13 2015 | -5701130242746129993
 Thu Jan 01 00:01:14 2015 | -5696835275397008041
 Thu Jan 01 00:01:15 2015 | -5692540306638054137
 Thu Jan 01 00:01:16 2015 | -5688245339075792272
 Thu Jan 01 00:01:17 2015 | -5683950372249748569
 Thu Jan 01 00:01:18 2015 | -5679655405593651134
 Thu Jan 01 00:01:19 2015 | -5675360437471364093
 Thu Jan 01 00:01:20 2015 | -5671065470588296269
 Thu Jan 01 00:01:21 2015 | -5666770504135325343
 Thu Jan 01 00:01:22 2015 | -5662475535406312602
 Thu Jan 01 00:01:23 2015 | -5658180569380492437
 Thu Jan 01 00:01:24 2015 | -5653885601798571515
 Thu Jan 01 00:01:25 2015 | -5649590634225656293
 Thu Jan 01 00:01:26 2015 | -5645295665970497348
 Thu Jan 01 00:01:27 2015 | -5641000699625871740
 Thu Jan 01 00:01:28 2015 | -5636705731397623040
 Thu Jan 01 00:01:29 2015 | -5632410765804674521
 Thu Jan 01 00:01:30 2015 | -5628115798546751758
 Thu Jan 01 00:01:31 2015 | -5623820830090632179
 Thu Jan 01 00:01:32 2015 | -5619525862332879388
 Thu Jan 01 00:01:33 2015 | -5615230894802424493
 Thu Jan 01 00:01:34 2015 | -5610935928407671869
 Thu Jan 01 00:01:35 2015 | -5606640961442584873
 Thu Jan 01 00:01:36 2015 | -5602345994630025658
 Thu Jan 01 00:01:37 2015 | -5598051025960051263
 Thu Jan 01 00:01:38 2015 | -5593756059271009925
 Thu Jan 01 00:01:39 2015 | -5589461092404278578
 Thu Jan 01 00:01:40 2015 | -5585166125301138044
(100 rows)

-- Ensure that hash index is created and cannot be dropped
CREATE CONTINUOUS VIEW hash_group AS SELECT x::int, COUNT(*) FROM hash_group_stream GROUP BY x;
CREATE CONTINUOUS VIEW ls_hash_group1 AS SELECT x::int, minute(y::timestamptz), COUNT(*) FROM hash_group_stream WHERE ( arrival_timestamp > clock_timestamp() - interval '5 hour' ) GROUP BY x, minute;
CREATE CONTINUOUS VIEW ls_hash_group2 AS SELECT x::int, y::timestamptz, COUNT(*) FROM hash_group_stream GROUP BY x, y;
\d+ hash_group_mrel;
                   Table "public.hash_group_mrel"
 Column |  Type   | Modifiers | Storage | Stats target | Description 
--------+---------+-----------+---------+--------------+-------------
 x      | integer |           | plain   |              | 
 count  | bigint  |           | plain   |              | 
 $pk    | bigint  | not null  | plain   |              | 
Indexes:
    "hash_group_mrel_pkey" PRIMARY KEY, btree ("$pk")
    "hash_group_mrel_expr_idx" btree (hash_group(x))
Options: fillfactor=50

\d+ ls_hash_group1_mrel;
                               Table "public.ls_hash_group1_mrel"
      Column       |           Type           | Modifiers | Storage | Stats target | Description 
-------------------+--------------------------+-----------+---------+--------------+-------------
 arrival_timestamp | timestamp with time zone |           | plain   |              | 
 x                 | integer                  |           | plain   |              | 
 minute            | timestamp with time zone |           | plain   |              | 
 count             | bigint                   |           | plain   |              | 
 $pk               | bigint                   | not null  | plain   |              | 
Indexes:
    "ls_hash_group1_mrel_pkey" PRIMARY KEY, btree ("$pk")
    "ls_hash_group1_mrel_expr_idx" btree (ls_hash_group(arrival_timestamp, x, minute))
Options: fillfactor=50

\d+ ls_hash_group2_mrel;
                           Table "public.ls_hash_group2_mrel"
 Column |            Type             | Modifiers | Storage | Stats target | Description 
--------+-----------------------------+-----------+---------+--------------+-------------
 x      | integer                     |           | plain   |              | 
 y      | timestamp(0) with time zone |           | plain   |              | 
 count  | bigint                      |           | plain   |              | 
 $pk    | bigint                      | not null  | plain   |              | 
Indexes:
    "ls_hash_group2_mrel_pkey" PRIMARY KEY, btree ("$pk")
    "ls_hash_group2_mrel_expr_idx" btree (ls_hash_group(x, y))
Options: fillfactor=50

DROP INDEX hash_group_mrel_expr_idx;
ERROR:  cannot drop index hash_group_mrel_expr_idx because table hash_group_mrel requires it
HINT:  You can drop table hash_group_mrel instead.
DROP INDEX ls_hash_group1_mrel_expr_idx;
ERROR:  cannot drop index ls_hash_group1_mrel_expr_idx because table ls_hash_group1_mrel requires it
HINT:  You can drop table ls_hash_group1_mrel instead.
DROP INDEX ls_hash_group2_mrel_expr_idx;
ERROR:  cannot drop index ls_hash_group2_mrel_expr_idx because table ls_hash_group2_mrel requires it
HINT:  You can drop table ls_hash_group2_mrel instead.
DROP CONTINUOUS VIEW hash_group;
DROP CONTINUOUS VIEW ls_hash_group1;
DROP CONTINUOUS VIEW ls_hash_group2;
